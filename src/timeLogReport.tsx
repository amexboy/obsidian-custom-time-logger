import {forwardRef, useMemo,} from 'react';
import {
	calculateMonthTotalMinutes,
	formatMinutes,
	groupDaysIntoWeeks,
	parseDate,
	parseDurationToMinutes,
	parseTime,
} from './helpers';
import {DayLogData, PeriodData} from './types';
import {differenceInMinutes} from 'date-fns';
import 'jspdf-autotable';
import styled from 'styled-components';

// Wrapper to center the A4 container
const CenterWrapper = styled.div`
	display: flex;
	justify-content: center;
	align-items: flex-start;
	width: 100%;
`;

// Styled Components with adjusted sizing for A4 proportions
const A4Container = styled.div`
	width: 210mm;
	min-height: 297mm;
	background-color: white;
	box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
	overflow: hidden; /* Prevent content from overflowing */
	margin: 0 auto; /* Center the container */
`;

const ReportContainer = styled.div`
	font-family: 'Arial', sans-serif;
	padding: 15mm; /* Use mm for consistent A4 proportions */
	color: #333;
	box-sizing: border-box; /* Include padding in width calculation */
	width: 100%;
`;

const Header = styled.div`
	text-align: start;
	margin-bottom: 10mm;
`;

const Title = styled.h1`
	font-size: 18pt;
	color: #0056b3;
	margin: 0;
`;

const Period = styled.p`
	font-size: 12pt;
	margin-top: 5pt;
`;

const WeekSection = styled.div`
	margin-bottom: 8mm;
`;

const WeekTitle = styled.h2`
	font-size: 14pt;
	color: #0056b3;
	margin-bottom: 5pt;
`;

const Table = styled.table`
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 5mm;
	table-layout: fixed; /* Fixed layout to control column widths */
`;

const TableHead = styled.thead`
	background-color: #f2f2f2;
`;

const TableRow = styled.tr`
	&:nth-child(even) {
		background-color: #f9f9f9;
	}
`;

const TableHeader = styled.th`
	padding: 8pt;
	text-align: left;
	border-bottom: 1px solid #ddd;
	font-weight: bold;
	font-size: 10pt;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
`;

const TableCell = styled.td`
	padding: 8pt;
	text-align: left;
	border-bottom: 1px solid #ddd;
	font-size: 10pt;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
`;

// Define column widths
const DateColumn = styled(TableCell)`
	width: 15%;
`;

const TimeColumn = styled(TableCell)`
	width: 12%;
`;

const BreakColumn = styled(TableCell)`
	width: 10%;
`;

const DurationColumn = styled(TableCell)`
	width: 15%;
`;

const NoteColumn = styled(TableCell)`
	width: 36%;
`;

// Header versions
const DateHeader = styled(TableHeader)`
	width: 15%;
`;

const TimeHeader = styled(TableHeader)`
	width: 12%;
`;

const BreakHeader = styled(TableHeader)`
	width: 10%;
`;

const DurationHeader = styled(TableHeader)`
	width: 25%;
`;

const NoteHeader = styled(TableHeader)`
	width: 25%;
`;

const Total = styled.div`
	text-align: right;
	font-weight: bold;
	font-size: 12pt;
	margin-bottom: 10mm;
`;

const Footer = styled.div`
	border-top: 2px solid #0056b3;
	padding-top: 10px;
	font-size: 20px;
	color: #777;
	display: flex;
	flex-direction: column;
	align-items: flex-end;
`;
const SignatureBox = styled.div`
	border: 1px solid #777;
	width: 200px;
	height: 80px;
	margin-top: 5px;
	display: flex;
	justify-content: center;
	align-items: center;
`;

const SignatureSVG = () => (
	<svg
		width="200"
		height="100"
		viewBox="0 0 600 400">
		<path
			d="m 412.23448,37.397307 c 4.20113,0.25 4.20113,0.25 8.55502,1 2.911,3.5728 2.65482,4.91872 2.48726,9.13672 -0.0931,5.35841 0.11428,10.60559 0.7161,15.94531 0.0783,0.69838 0.15663,1.39676 0.23733,2.1163 0.16556,1.4542 0.3328,2.90827 0.5016,4.36222 1.52906,13.30308 2.5999,26.58341 3.08505,39.939453 0.0419,1.06452 0.0419,1.06452 0.0847,2.15054 0.47577,12.48103 0.47577,12.48103 -1.00131,16.34946 1.36658,-0.0909 2.73316,-0.18176 4.14116,-0.27539 48.33243,-3.16482 95.64151,-4.53194 143.73852,1.27539 0,1.32 0,2.64 0,4 -7.61271,-0.39782 -15.21374,-0.8168 -22.79798,-1.48975 -15.40807,-1.35533 -30.61052,-1.82991 -46.10051,-1.76025 -1.15251,0.002 -2.30501,0.003 -3.49245,0.005 -18.18308,0.0325 -36.20986,0.62603 -54.33511,1.8071 -7.06434,0.45107 -14.071,0.54286 -21.15363,0.4375 -0.20633,1.24366 -0.20633,1.24366 -0.41682,2.51245 -1.15509,6.76072 -3.08252,12.43176 -6.91605,18.48795 -1.74439,2.85462 -1.60434,5.46839 -1.83322,8.65234 -0.0496,0.65594 -0.0992,1.31188 -0.15039,1.98769 -0.1586,2.09893 -0.3104,4.19813 -0.46069,6.29747 -0.19803,2.75942 -0.40264,5.51844 -0.61107,8.27734 -0.0882,1.2284 -0.17645,2.4568 -0.26734,3.72242 -0.34373,3.06274 -0.34373,3.06274 -1.56588,6.06274 0.95944,-0.22816 1.91887,-0.45633 2.90738,-0.69141 13.55905,-3.03566 13.55905,-3.03566 20.3134,-1.30859 3.3355,1.95944 4.59002,3.15608 5.72881,6.375 -1.35222,4.22454 -5.28326,6.03638 -9.39525,8.625 -14.41816,9.39717 -23.17902,22.10451 -25.56959,37.19141 -0.20946,8.35481 1.86807,16.59704 3.57096,24.80859 2.46876,12.32376 3.86307,23.3319 -2.44429,35 -1.61324,-0.33 -3.22647,-0.66 -4.88859,-1 -3.35385,-19.34128 -6.18967,-37.74218 -3.3609,-57.25 0.15961,-1.13865 0.31923,-2.27729 0.48367,-3.45044 2.00713,-14.11728 4.26709,-28.20996 6.54367,-42.29956 -1.36206,0.15146 -2.7241,0.30293 -4.12743,0.45898 -5.08077,0.56375 -10.16252,1.1214 -15.2446,1.67725 -2.19432,0.24086 -4.38838,0.48335 -6.58216,0.72754 -3.16359,0.35184 -6.32808,0.69771 -9.49282,1.04248 -0.97169,0.10937 -1.9434,0.21874 -2.94453,0.33142 -5.59132,0.60239 -10.96534,0.86971 -16.60503,0.76233 0.26467,0.91781 0.52935,1.83562 0.80203,2.78125 3.76056,13.56163 3.6768,23.94862 -4.85039,36.46875 -2.97139,5.05033 -2.04397,10.12931 -1.30957,15.54785 0.61797,4.8645 0.19781,8.53249 -1.97495,13.20215 -3.20813,2.9375 -3.20813,2.9375 -6.11073,5 -1.20992,-0.33 -2.41985,-0.66 -3.66644,-1 0.37756,-3.37534 0.76114,-6.7502 1.14577,-10.125 0.15951,-1.42699 0.15951,-1.42699 0.32224,-2.88281 0.15951,-1.39219 0.15951,-1.39219 0.32224,-2.8125 0.10156,-0.91129 0.20323,-1.82258 0.30793,-2.76148 0.34612,-2.41821 0.34612,-2.41821 1.29614,-5.36743 0.46164,-5.17554 -1.9222,-9.852 -3.85262,-14.73828 -4.09464,-10.41102 -6.58522,-19.39669 -4.43028,-30.3125 -27.44148,3.18065 -54.44123,6.80634 -81.30255,12.45264 -3.02553,0.54736 -3.02553,0.54736 -6.69197,0.54736 0.13932,1.62581 0.29522,3.25067 0.45831,4.875 0.0851,0.90492 0.17014,1.80984 0.2578,2.74219 0.25633,2.56223 0.25633,2.56223 2.95033,4.38281 2.41985,-1.65 4.8397,-3.3 7.33288,-5 0.80661,0.33 1.61323,0.66 2.44429,1 -0.91011,7.74468 -0.91011,7.74468 -4.88858,11 -1.20993,0.33 -2.41985,0.66 -3.66644,1 -14.07094,15.14669 -20.95183,33.34735 -22.95045,52.06641 -1.18963,10.43113 -3.73806,20.51224 -6.38106,30.74609 -4.2054,16.36641 -7.06138,32.49556 -8.55502,49.1875 -2.01654,0 -4.03308,0 -6.11073,0 -2.42547,-3.9692 -1.52143,-8.16528 -0.04,-12.29712 1.2496,-3.66611 1.78266,-6.9726 2.131,-10.76147 0.13302,-1.35721 0.26651,-2.71439 0.40041,-4.07154 0.0666,-0.70275 0.13308,-1.4055 0.20163,-2.12954 1.83592,-19.08187 4.94307,-37.67783 11.02058,-56.19175 1.97049,-6.23904 2.97155,-12.39565 3.77833,-18.79858 1.94832,-15.26545 6.98515,-29.96331 11.83954,-44.75 -30.05152,8.09706 -59.48182,17.00827 -88.67587,26.98126 -5.22163,1.78201 -10.44832,3.55408 -15.6744,5.32733 -2.15161,0.73027 -4.30319,1.46058 -6.45476,2.19092 -1.06519,0.36156 -2.13039,0.72313 -3.22786,1.09564 -3.19461,1.08483 -6.38863,2.17079 -9.58259,3.2569 -22.683371,7.70903 -45.414946,15.33771 -68.414219,22.39795 -1.390411,0.4324 -1.390411,0.4324 -2.808907,0.87354 -4.204036,1.26587 -7.160188,1.87646 -11.70409,1.87646 0,-1.32 0,-2.64 0,-4 0.762802,-0.22438 1.525605,-0.44875 2.311518,-0.67993 32.417461,-9.57975 64.253425,-20.28768 96.012158,-31.23389 53.52876,-18.44809 53.52876,-18.44809 78.93047,-24.94946 1.88,-0.48761 3.75997,-0.97532 5.63989,-1.46314 3.62196,-0.93829 7.25431,-1.83487 10.90026,-2.70849 1.64491,-0.41943 3.28938,-0.84002 4.93333,-1.26197 1.45127,-0.35416 2.90253,-0.70833 4.39776,-1.07324 3.82548,-1.43868 3.82548,-1.43868 5.08015,-5.06836 3.01463,-13.73954 4.24923,-26.69961 -5.63483,-38.74902 -7.86142,-8.77168 -7.86142,-8.77168 -19.2488,-13.8125 -3.02481,2.97 -3.02481,2.97 -6.11073,6 -1.61323,-0.66 -3.22647,-1.32 -4.88859,-2 1.86633,-3.43595 4.39884,-6.11912 7.33288,-9 -0.898,-0.28102 -1.79598,-0.56203 -2.72118,-0.85156 -3.06002,-1.03679 -5.83993,-2.21785 -8.73644,-3.52344 -8.69581,-3.61627 -18.15984,-5.30904 -27.62539,-7.07666 -2.34106,-0.47412 -2.34106,-0.47412 -6.13639,-1.54834 -1.22215,-3 -1.22215,-3 0.38192,-5.8125 6.58857,-7.46588 20.33304,-11.85274 31.01673,-13.78125 5.30898,-0.53338 10.53862,-0.59703 15.88312,-0.59375 1.62052,-9.7e-4 1.62052,-9.7e-4 3.27378,-0.002 7.7898,0.0515 15.20237,0.59815 22.77321,2.18945 0.34394,-0.71229 0.68787,-1.42457 1.04222,-2.15844 2.45291,-4.97127 5.11226,-9.86907 7.74196,-14.77906 0.90552,-1.69951 0.90552,-1.69951 1.82934,-3.43335 3.06479,-5.706133 6.24728,-11.240413 9.93381,-16.691653 6.09666,-9.57935 8.38716,-20.46343 11.22847,-30.9375 2.01654,-0.33 4.03308,-0.66 6.11073,-1 3.20157,4.66656 3.62554,8.75204 2.44429,14 -1.89292,3.25543 -4.04774,6.2154 -6.44491,9.23828 -3.23527,4.23434 -4.82645,8.2051 -5.77655,13.1211 -0.20047,1.02617 -0.40095,2.05235 -0.60749,3.10962 -0.20284,1.08273 -0.40567,2.16546 -0.61466,3.281 -0.31843,1.66181 -0.31843,1.66181 -0.6433,3.35718 -1.68618,8.941513 -3.09573,17.895303 -4.24528,26.892873 52.50872,9.29087 101.94453,7.71604 155.21255,4 0.59253,-17.18466 -0.69215,-34.133423 -2.36224,-51.253173 -0.83713,-8.75352 -1.49091,-17.47596 -1.57154,-26.25855 -0.0136,-0.78261 -0.0271,-1.56521 -0.0411,-2.37154 0.021,-8.88154 0.021,-8.88154 3.97485,-12.11674 z m 2.44429,4 c -1.43646,3.52607 -1.42707,6.70593 -1.40833,10.375 0.002,0.74677 0.005,1.49354 0.007,2.26294 0.0968,8.55788 0.8746,17.07007 1.67666,25.5997 0.44168,4.70748 0.85791,9.41644 1.27128,14.12564 0.12123,1.37954 0.12123,1.37954 0.24501,2.78694 0.94445,10.940093 1.49109,21.887263 1.87464,32.849783 1.20992,0 2.41985,0 3.66644,0 1.00412,-4.24001 1.32468,-8.1397 1.16008,-12.45313 -0.0697,-1.86881 -0.0697,-1.86881 -0.14084,-3.77539 -0.059,-1.34051 -0.11867,-2.681 -0.17902,-4.02148 -0.0427,-1.0271 -0.0427,-1.0271 -0.0863,-2.07495 -0.43823,-10.469033 -1.22463,-20.893043 -2.30196,-31.332283 -0.8601,-8.43193 -1.36779,-16.85696 -1.70074,-25.31347 -0.0386,-0.89655 -0.0772,-1.79309 -0.11696,-2.7168 -0.0439,-1.18143 -0.0439,-1.18143 -0.0886,-2.38672 -0.0769,-2.00871 -0.0769,-2.00871 -1.43428,-3.92578 -0.80662,0 -1.61323,0 -2.44429,0 z m -145.43538,22 c 1.22215,2 1.22215,2 1.22215,2 z m -14.66575,32 c -2.21822,3.93634 -4.43223,7.874273 -6.64542,11.812503 -0.63096,1.11955 -1.26192,2.2391 -1.91199,3.39258 -0.6026,1.07314 -1.20521,2.14629 -1.82606,3.25195 -0.55682,0.98976 -1.11363,1.97952 -1.68732,2.99927 -1.45391,2.58616 -1.45391,2.58616 -2.59497,5.5437 6.04963,0.99 6.04963,0.99 12.22147,2 0.65114,-4.08187 1.28221,-8.16565 1.9096,-12.25 0.1851,-1.15887 0.37022,-2.31773 0.56094,-3.51172 0.16936,-1.11504 0.33872,-2.23008 0.51321,-3.37891 0.16001,-1.02641 0.32001,-2.05283 0.48485,-3.11035 0.18395,-2.556013 -0.0587,-4.335723 -1.02431,-6.749023 z m -85.55023,38.000003 c -0.80661,0.99 -1.61323,1.98 -2.44429,3 1.47775,0.27973 2.95549,0.55945 4.47802,0.84766 12.99299,2.56549 24.16802,5.82883 35.8528,11.15234 1.6247,0.67451 3.25202,1.34497 4.88858,2 10.72292,-11.00619 10.72292,-11.00619 19.55434,-23 -0.60496,-1.485 -0.60496,-1.485 -1.22214,-3 -21.3774,-2.89957 -43.24696,-2.11606 -61.10731,9 z m 67.21804,-7 c -0.57819,0.87141 -1.15636,1.74281 -1.75206,2.64062 -5.61889,8.32779 -11.80754,15.89601 -19.02443,23.35938 2.82719,2.32934 5.65116,4.65004 8.58844,6.88672 9.6896,7.47437 15.1672,15.54918 18.29878,26.11328 1.20992,-0.495 1.20992,-0.495 2.44429,-1 0.79082,-2.90726 0.79082,-2.90726 1.26512,-6.45703 0.10217,-0.6582 0.20429,-1.31641 0.30954,-1.99455 0.21564,-1.40257 0.42588,-2.8057 0.63123,-4.20931 0.30808,-2.10578 0.63081,-4.20976 0.95689,-6.31372 1.58957,-10.38806 3.16361,-20.79149 3.02433,-31.27539 -0.011,-1.09828 -0.022,-2.19656 -0.0334,-3.32813 -0.0142,-0.79921 -0.0284,-1.59843 -0.043,-2.42187 -5.08346,-1.30492 -9.34987,-2.1202 -14.66575,-2 z m 19.55433,3 c -0.10901,1.26046 -0.10901,1.26046 -0.2202,2.54639 -1.82106,20.41894 -4.62649,40.60531 -8.3569,60.85156 -0.23918,1.30554 -0.23918,1.30554 -0.4832,2.63745 -0.30014,1.63015 -0.60475,3.25975 -0.91471,4.88867 -0.69033,3.72399 -1.2005,7.30697 -1.0243,11.07593 1.15223,-0.21616 2.30445,-0.43232 3.49158,-0.65503 5.50261,-1.02716 11.01143,-2.03093 16.52106,-3.03247 1.50796,-0.27652 1.50796,-0.27652 3.04638,-0.55862 11.36876,-2.07256 22.67569,-3.93127 34.2434,-5.08201 0.953,-0.0978 1.90601,-0.19566 2.88789,-0.29646 4.55222,-0.46099 9.09974,-0.87207 13.66776,-1.21208 8.41107,-0.48719 8.41107,-0.48719 15.02471,-4.22021 1.23983,-2.30338 1.99415,-4.51638 2.77817,-6.94312 0.93265,-1.01063 1.8653,-2.02125 2.82622,-3.0625 2.89013,-4.11649 1.99678,-6.36358 0.84022,-10.9375 -2.00394,0.2475 -2.00394,0.2475 -4.04836,0.5 -10.81205,1.06286 -20.01683,0.94672 -30.17173,-2.5 -0.88224,0.84562 -1.76447,1.69125 -2.67344,2.5625 -3.43729,2.4375 -3.43729,2.4375 -6.79819,2.3125 -2.74983,-0.875 -2.74983,-0.875 -3.97197,-1.875 -0.19044,-1.34015 -0.30608,-2.68759 -0.3867,-4.03516 -0.0512,-0.80888 -0.10242,-1.61777 -0.15516,-2.45117 -0.048,-0.85013 -0.0961,-1.70027 -0.1456,-2.57617 -0.0528,-0.854 -0.1056,-1.70801 -0.15993,-2.58789 -0.13005,-2.11633 -0.25306,-4.23295 -0.37476,-6.34961 -7.23613,0.57799 -10.13862,1.49699 -14.9522,5.74609 -3.34333,3.49216 -6.08076,7.25374 -8.78418,11.09375 -0.63646,0.71286 -1.27293,1.42571 -1.92869,2.16016 -1.20992,0 -2.41985,0 -3.66644,0 3.01248,-5.30903 6.30264,-9.77432 10.78926,-14.33594 1.66677,-1.59738 1.66677,-1.59738 1.4322,-3.66406 8.00658,-3.27562 10.82246,-4 20.77649,-4 0.60496,9.405 0.60496,9.405 1.22214,19 4.89641,-1.45881 4.89641,-1.45881 5.81474,-3.81641 0.32739,-2.41519 0.28034,-4.6941 0.14323,-7.12109 -0.0605,-4.19537 0.41501,-6.74142 3.8192,-10.0625 3.92871,-1.6073 7.97314,-1.61931 12.22146,-1 3.59006,2.4375 3.59006,2.4375 6.11073,5 0.40331,0.33 0.80662,0.66 1.22215,1 0.17346,3.00331 0.0518,5.99217 0,9 -3.62977,1.32 -7.25955,2.64 -10.99932,4 5.21571,2.8451 9.76681,2.39342 15.8879,2 2.98602,-0.50074 5.66749,-1.1782 8.55503,-2 -0.0638,-1.19496 -0.0638,-1.19496 -0.1289,-2.41406 -0.33803,-10.82602 -0.33803,-10.82602 3.79533,-15.58594 3.77507,-2.05926 4.53338,-2.23904 8.78418,-2.125 1.53761,0.0413 3.07522,0.0825 4.65943,0.125 2.44968,4.1341 2.94353,7.42495 2.44429,12 -1.86568,4.00723 -4.38655,5.4493 -8.78417,7.5 -2.58215,1.15717 -2.58215,1.15717 -4.65943,2.5 -0.82074,2.71658 -0.82074,2.71658 0,5 4.78791,-1.45739 9.10095,-3.2814 13.51999,-5.375 1.24931,-0.58523 2.49861,-1.17047 3.78579,-1.77344 3.25448,-1.73621 5.74026,-3.51845 8.35928,-5.85156 -1.81488,-0.495 -1.81488,-0.495 -3.66643,-1 -0.41005,-5.48002 0.43422,-9.16658 3.66643,-14 2.74983,-2.5 2.74983,-2.5 6.11073,-4 4.65944,0.25 4.65944,0.25 8.55503,1 -0.0504,1.19625 -0.10083,2.3925 -0.15277,3.625 0.45864,3.08504 1.10331,4.16083 3.87649,6.34766 3.20517,1.74441 6.06496,3.03491 9.71988,4.02734 6.5066,-1.1346 10.63536,-3.72507 14.66576,-8 0.74229,-3.45932 0.57832,-6.81409 0.38192,-10.3125 -0.0276,-0.93135 -0.0551,-1.8627 -0.0836,-2.82227 -0.0717,-2.29007 -0.17199,-4.57681 -0.29832,-6.86523 -1.96968,0.12846 -1.96968,0.12846 -3.97914,0.25952 -93.60183,6.0583 -93.60183,6.0583 -136.65419,-1.64184 -5.65183,-0.97517 -11.33421,-1.80358 -17.02352,-2.61768 z m 162.54543,4 c 0,3.3 0,6.6 0,10 2.80646,-3.44451 3.10445,-5.93812 3.66644,-10 -1.20993,0 -2.41985,0 -3.66644,0 z m -45.2194,20 c -1.66012,3.62473 -1.66012,3.62473 -2.4443,7 3.47555,-1.46401 6.74602,-2.97075 9.77717,-5 1.38035,-3.16461 1.38035,-3.16461 1.22215,-6 -4.04643,0 -5.73264,1.74836 -8.55502,4 z m -29.33151,4 c -1.17412,2.88211 -1.35147,4.6985 -1.29853,7.6875 0.011,0.80824 0.0221,1.61648 0.0334,2.44922 0.0142,0.61488 0.0284,1.22976 0.043,1.86328 4.78735,-0.85192 7.52242,-2.0782 10.99932,-5 1.17451,-3.91272 1.56168,-6.16653 0,-10 -5.20401,0 -6.14529,0.23322 -9.77717,3 z m -36.43523,-0.5 c -2.12531,3.66105 -1.77475,6.46398 -1.4513,10.5 0.40331,0.33 0.80662,0.66 1.22215,1 7.69446,-0.48296 7.69446,-0.48296 14.66575,-3 -0.32351,-4.90189 -0.32351,-4.90189 -3.3609,-8.9375 -4.29174,-1.65828 -7.27627,-2.13532 -11.0757,0.4375 z m 75.5439,2.5 c -1.91478,1.7686 -1.91478,1.7686 -3.74282,4.0625 -6.96139,7.63461 -16.70966,11.95966 -26.77264,16.48047 -2.87456,1.68715 -3.92927,2.68097 -4.92677,5.45703 0.49189,2.62843 0.49189,2.62843 1.68045,5.25 0.36234,0.89203 0.72469,1.78406 1.09802,2.70312 0.29303,0.67547 0.58606,1.35094 0.88797,2.04688 7.5627,0.10776 14.74809,-0.24026 22.23256,-1.09375 1.01525,-0.11098 2.03051,-0.22196 3.07653,-0.3363 3.20043,-0.35113 6.39941,-0.71039 9.59845,-1.06995 2.1872,-0.24143 4.37449,-0.48232 6.56188,-0.72266 5.32486,-0.58625 10.64845,-1.17979 15.97144,-1.77734 4.11108,-9.75759 3.86615,-19.75956 3.66644,-30 -0.68059,0.31195 -1.36117,0.62391 -2.06237,0.94531 -4.94644,2.06469 -8.6456,3.56349 -14.20745,2.49219 -3.8474,-1.22721 -6.25651,-2.34487 -9.39525,-4.4375 -1.20992,0 -2.41985,0 -3.66644,0 z m -40.33082,28 c -2.41985,4.455 -2.41985,4.455 -4.88858,9 3.83828,1.34513 3.83828,1.34513 8.55502,0 -0.80661,-2.97 -1.61323,-5.94 -2.44429,-9 -0.40331,0 -0.80662,0 -1.22215,0 z m 79.05758,3.3125 c -1.28082,0.26426 -2.56165,0.52852 -3.88127,0.80078 -3.25654,0.61371 -3.25654,0.61371 -4.29183,2.88672 -0.26816,1.59123 -0.47737,3.18929 -0.65405,4.78906 -0.10632,0.94102 -0.21268,1.88203 -0.32224,2.85156 -0.10633,0.98485 -0.21268,1.96969 -0.32224,2.98438 -0.1111,0.99258 -0.22214,1.98516 -0.33657,3.00781 -0.27412,2.45543 -0.54366,4.91113 -0.8092,7.36719 2.3438,-2.36608 4.65191,-4.72733 6.80774,-7.21094 4.71213,-5.36686 9.56875,-8.76806 16.48464,-12.18359 0.783,-0.52981 1.56598,-1.05961 2.37269,-1.60547 0,-1.32 0,-2.64 0,-4 -5.57605,-1.01921 -9.53413,-0.87293 -15.04767,0.3125 z m -85.16831,10.6875 c -1.58448,7.31386 -1.18675,13.65325 0.91661,20.8125 0.31016,1.05659 0.31016,1.05659 0.62659,2.13452 1.43962,4.57019 3.40192,8.75813 5.78968,13.05298 6.17708,-5.05429 8.13935,-13.04348 8.69825,-19.97266 -0.27523,-5.81751 -2.03557,-11.4095 -3.80967,-17.02734 -4.30436,-0.08 -8.09038,-0.0401 -12.22146,1 z m -98.99383,21 c -1.23401,3.89338 -2.45168,7.79007 -3.66644,11.6875 -0.34974,1.10279 -0.69948,2.20559 -1.05983,3.3418 -0.49625,1.60005 -0.49625,1.60005 -1.00254,3.23242 -0.30721,0.97928 -0.61441,1.95857 -0.93093,2.96753 -0.64955,2.67366 -0.80034,5.05389 -0.67313,7.77075 3.39656,-3.47835 6.0462,-7.25602 8.70779,-11.125 0.43954,-0.63293 0.87909,-1.26586 1.33194,-1.91797 1.5933,-2.29977 3.18087,-4.59209 4.62602,-6.95703 -0.55455,-0.37125 -1.1091,-0.7425 -1.68045,-1.125 -2.56075,-2.41765 -3.35495,-4.82931 -4.43028,-7.875 -0.40331,0 -0.80662,0 -1.22215,0 z m -8.55502,29 c 1.22215,3 1.22215,3 1.22215,3 z m 175.98903,7 c 1.22215,3 1.22215,3 1.22215,3 z m 1.22215,6 c -0.30543,6.6505 0.31831,12.56987 2.44429,19 1.78238,-3.95705 0.82991,-7.69831 0.0764,-11.75 -0.1221,-0.69738 -0.24419,-1.39477 -0.36998,-2.11328 -0.30118,-1.71324 -0.61374,-3.42513 -0.92855,-5.13672 -0.40331,0 -0.80662,0 -1.22215,0 z"
			fill="#000000"
		/>
	</svg>

);


const FooterText = styled.div`
	text-align: left;
`;

interface TimeLogReportProps {
	monthName: string;
	monthData: DayLogData;
	projectName: string;
	period: PeriodData;
	onGeneratePdf?: () => void;
}

const TimeLogReport = forwardRef<HTMLDivElement, TimeLogReportProps>(
	({monthName, monthData, projectName, period}, reportRef) => {
		const weeks = useMemo(() => groupDaysIntoWeeks(monthData), [monthData]);
		const totalMonthMinutes = useMemo(
			() => calculateMonthTotalMinutes(monthData),
			[monthData],
		);
		const formattedTotal = formatMinutes(totalMonthMinutes);

		return (
			<CenterWrapper>
				<A4Container>
					<ReportContainer ref={reportRef}>
						<Header>
							<Title>Time Log Report - {monthName}</Title>
							<Period>
								{period.from} - {period.to}
							</Period>
						</Header>

						{weeks.map((week) => (
							<WeekSection key={week.weekNumber}>
								<WeekTitle>Week {week.weekNumber}</WeekTitle>
								<Table>
									<TableHead>
										<TableRow>
											<DateHeader>Date</DateHeader>
											<TimeHeader>From</TimeHeader>
											<TimeHeader>To</TimeHeader>
											<BreakHeader>Break</BreakHeader>
											<DurationHeader>Duration</DurationHeader>
											<NoteHeader>Note</NoteHeader>
										</TableRow>
									</TableHead>
									<tbody>
									{week.days.map((day) =>
										day.entries.map((entry, index) => {
											const baseDate = parseDate(day.dateStr);
											const startTime =
												baseDate && parseTime(baseDate, entry.from);
											const endTime = baseDate && parseTime(baseDate, entry.to);
											const breakMinutes =
												parseDurationToMinutes(entry.break);

											let durationMinutes = 0;
											let durationStr = 'Invalid';

											if (startTime && endTime && endTime > startTime) {
												durationMinutes =
													differenceInMinutes(endTime, startTime) -
													breakMinutes;
												durationStr = formatMinutes(durationMinutes);
											} else if (startTime && endTime) {
												durationStr = 'Negative/Zero';
											}

											return (
												<TableRow key={index}>
													<DateColumn>{day.dateStr}</DateColumn>
													<TimeColumn>{entry.from}</TimeColumn>
													<TimeColumn>{entry.to}</TimeColumn>
													<BreakColumn>{entry.break || ''}</BreakColumn>
													<DurationColumn>{durationStr}</DurationColumn>
													<NoteColumn>{entry.note || ''}</NoteColumn>
												</TableRow>
											);
										}),
									)}
									</tbody>
								</Table>
							</WeekSection>
						))}

						<Total>Total: {formattedTotal}</Total>

						<Footer>
							<FooterText>Amanuel Nega Mekonnen</FooterText>
							<SignatureBox>
								<SignatureSVG/>
							</SignatureBox>
							<FooterText>{new Date().toLocaleDateString()}</FooterText>
						</Footer>
					</ReportContainer>
				</A4Container>
			</CenterWrapper>
		);
	},
);

TimeLogReport.displayName = 'TimeLogReport';
export default TimeLogReport;
